<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="1150pt" height="310pt" viewBox="0 0 1149.83 310"><g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 306)"><title>%3</title><polygon fill="#fff" stroke="transparent" points="-4 4 -4 -306 1145.828 -306 1145.828 4 -4 4"/><g id="clust1" class="cluster"><title>cluster_sshportal</title><polygon fill="none" stroke="silver" points="187.559 -8 187.559 -294 964.46 -294 964.46 -8 187.559 -8"/><text x="576.009" y="-275.6" fill="#000" font-family="Helvetica,sans-Serif" font-size="18" font-weight="bold" text-anchor="middle">sshportal</text></g><g id="clust6" class="cluster"><title>cluster_hosts</title><polygon fill="none" stroke="silver" points="985.46 -104 985.46 -294 1133.828 -294 1133.828 -104 985.46 -104"/><text x="1059.644" y="-275.6" fill="#000" font-family="Helvetica,sans-Serif" font-size="18" font-weight="bold" text-anchor="middle">your hosts</text></g><g id="node1" class="node"><title>start</title><path fill="none" stroke="#00f" d="M12,-122C12,-122 146.5586,-122 146.5586,-122 152.5586,-122 158.5586,-128 158.5586,-134 158.5586,-134 158.5586,-146 158.5586,-146 158.5586,-152 152.5586,-158 146.5586,-158 146.5586,-158 12,-158 12,-158 6,-158 0,-152 0,-146 0,-146 0,-134 0,-134 0,-128 6,-122 12,-122"/><text x="79.279" y="-134.6" fill="#00f" font-family="Helvetica,sans-Serif" font-size="18" font-weight="bold" text-anchor="middle">$&gt; ssh sshportal</text></g><g id="node2" class="node"><title>known_user_key</title><path fill="none" stroke="#ff8c00" d="M216.1104,-161C216.1104,-161 313.1514,-161 313.1514,-161 319.1514,-161 325.1514,-167 325.1514,-173 325.1514,-173 325.1514,-185 325.1514,-185 325.1514,-191 319.1514,-197 313.1514,-197 313.1514,-197 216.1104,-197 216.1104,-197 210.1104,-197 204.1104,-191 204.1104,-185 204.1104,-185 204.1104,-173 204.1104,-173 204.1104,-167 210.1104,-161 216.1104,-161"/><text x="264.631" y="-174.8" fill="#ff8c00" font-family="Helvetica,sans-Serif" font-size="14" font-weight="bold" text-anchor="middle">known user key</text></g><g id="edge1" class="edge"><title>start-&gt;known_user_key</title><path fill="none" stroke="#00f" d="M158.6917,-156.7092C173.8232,-159.8931 189.4365,-163.1783 203.8727,-166.2158"/></g><g id="node3" class="node"><title>unknown_user_key</title><path fill="none" stroke="#ff8c00" d="M207.5586,-69C207.5586,-69 321.7031,-69 321.7031,-69 327.7031,-69 333.7031,-75 333.7031,-81 333.7031,-81 333.7031,-93 333.7031,-93 333.7031,-99 327.7031,-105 321.7031,-105 321.7031,-105 207.5586,-105 207.5586,-105 201.5586,-105 195.5586,-99 195.5586,-93 195.5586,-93 195.5586,-81 195.5586,-81 195.5586,-75 201.5586,-69 207.5586,-69"/><text x="264.631" y="-82.8" fill="#ff8c00" font-family="Helvetica,sans-Serif" font-size="14" font-weight="bold" text-anchor="middle">unknown user key</text></g><g id="edge2" class="edge"><title>start-&gt;unknown_user_key</title><path fill="none" stroke="#00f" d="M142.2895,-121.9827C161.3902,-116.521 182.3703,-110.5218 201.4801,-105.0575"/></g><g id="node5" class="node"><title>acl_manager</title><path fill="none" stroke="#ff8c00" d="M608.9287,-173C608.9287,-173 691.7031,-173 691.7031,-173 697.7031,-173 703.7031,-179 703.7031,-185 703.7031,-185 703.7031,-197 703.7031,-197 703.7031,-203 697.7031,-209 691.7031,-209 691.7031,-209 608.9287,-209 608.9287,-209 602.9287,-209 596.9287,-203 596.9287,-197 596.9287,-197 596.9287,-185 596.9287,-185 596.9287,-179 602.9287,-173 608.9287,-173"/><text x="650.316" y="-186.8" fill="#ff8c00" font-family="Helvetica,sans-Serif" font-size="14" font-weight="bold" text-anchor="middle">ACL manager</text></g><g id="edge9" class="edge"><title>known_user_key-&gt;acl_manager</title><path fill="none" stroke="#ff8c00" d="M325.3184,-180.8882C399.9907,-183.2115 525.6007,-187.1197 596.8147,-189.3354"/><text x="463.306" y="-190.8" fill="#ff8c00" font-family="Helvetica,sans-Serif" font-size="14" text-anchor="middle">user matches an existing host</text></g><g id="node6" class="node"><title>builtin_shell</title><path fill="none" stroke="#006400" d="M874.6738,-223C874.6738,-223 944.46,-223 944.46,-223 950.46,-223 956.46,-229 956.46,-235 956.46,-235 956.46,-247 956.46,-247 956.46,-253 950.46,-259 944.46,-259 944.46,-259 874.6738,-259 874.6738,-259 868.6738,-259 862.6738,-253 862.6738,-247 862.6738,-247 862.6738,-235 862.6738,-235 862.6738,-229 868.6738,-223 874.6738,-223"/><text x="909.567" y="-243.8" fill="#006400" font-family="Helvetica,sans-Serif" font-size="14" font-weight="bold" text-anchor="middle">built-in</text><text x="909.567" y="-229.8" fill="#006400" font-family="Helvetica,sans-Serif" font-size="14" font-weight="bold" text-anchor="middle">config shell</text></g><g id="edge6" class="edge"><title>known_user_key-&gt;builtin_shell</title><path fill="none" stroke="#006400" d="M325.3695,-196.5059C340.0986,-200.1819 355.8759,-203.652 370.7031,-206 550.8024,-234.5204 768.2909,-239.9067 862.3934,-240.8487"/><text x="650.316" y="-238.8" fill="#006400" font-family="Helvetica,sans-Serif" font-size="14" text-anchor="middle">user=admin</text></g><g id="node9" class="node"><title>err_and_exit</title><path fill="none" stroke="red" d="M887.1152,-81C887.1152,-81 932.0186,-81 932.0186,-81 938.0186,-81 944.0186,-87 944.0186,-93 944.0186,-93 944.0186,-137 944.0186,-137 944.0186,-143 938.0186,-149 932.0186,-149 932.0186,-149 887.1152,-149 887.1152,-149 881.1152,-149 875.1152,-143 875.1152,-137 875.1152,-137 875.1152,-93 875.1152,-93 875.1152,-87 881.1152,-81 887.1152,-81"/><text x="909.567" y="-117.8" fill="red" font-family="Helvetica,sans-Serif" font-size="14" font-weight="bold" text-anchor="middle">error</text><text x="909.567" y="-103.8" fill="red" font-family="Helvetica,sans-Serif" font-size="14" font-weight="bold" text-anchor="middle">and exit</text></g><g id="edge11" class="edge"><title>known_user_key-&gt;err_and_exit</title><path fill="none" stroke="red" d="M325.3049,-172.979C457.9451,-159.8165 770.2119,-128.8288 874.7656,-118.4535"/><text x="650.316" y="-148.8" fill="red" font-family="Helvetica,sans-Serif" font-size="14" text-anchor="middle">invalid user</text></g><g id="node4" class="node"><title>invite_manager</title><path fill="none" stroke="#ff8c00" d="M604.9092,-17C604.9092,-17 695.7227,-17 695.7227,-17 701.7227,-17 707.7227,-23 707.7227,-29 707.7227,-29 707.7227,-41 707.7227,-41 707.7227,-47 701.7227,-53 695.7227,-53 695.7227,-53 604.9092,-53 604.9092,-53 598.9092,-53 592.9092,-47 592.9092,-41 592.9092,-41 592.9092,-29 592.9092,-29 592.9092,-23 598.9092,-17 604.9092,-17"/><text x="650.316" y="-30.8" fill="#ff8c00" font-family="Helvetica,sans-Serif" font-size="14" font-weight="bold" text-anchor="middle">invite manager</text></g><g id="edge10" class="edge"><title>unknown_user_key-&gt;invite_manager</title><path fill="none" stroke="#ff8c00" d="M334.0291,-77.6434C407.9842,-67.6724 523.7263,-52.0674 592.789,-42.7561"/><text x="463.306" y="-74.8" fill="#ff8c00" font-family="Helvetica,sans-Serif" font-size="14" text-anchor="middle">user=invite:&lt;token&gt;</text></g><g id="edge13" class="edge"><title>unknown_user_key-&gt;err_and_exit</title><path fill="none" stroke="red" d="M333.7181,-89.2908C439.591,-92.8626 637.1209,-99.7853 707.7227,-104 724.1917,-104.9832 728.2588,-105.9333 744.7227,-107 789.6129,-109.9084 841.4427,-112.2584 874.8164,-113.641"/><text x="650.316" y="-106.8" fill="red" font-family="Helvetica,sans-Serif" font-size="14" text-anchor="middle">any other user</text></g><g id="node8" class="node"><title>learn_key</title><path fill="none" stroke="#006400" d="M884.3911,-17C884.3911,-17 934.7427,-17 934.7427,-17 940.7427,-17 946.7427,-23 946.7427,-29 946.7427,-29 946.7427,-41 946.7427,-41 946.7427,-47 940.7427,-53 934.7427,-53 934.7427,-53 884.3911,-53 884.3911,-53 878.3911,-53 872.3911,-47 872.3911,-41 872.3911,-41 872.3911,-29 872.3911,-29 872.3911,-23 878.3911,-17 884.3911,-17"/><text x="909.567" y="-37.8" fill="#006400" font-family="Helvetica,sans-Serif" font-size="14" font-weight="bold" text-anchor="middle">learn the</text><text x="909.567" y="-23.8" fill="#006400" font-family="Helvetica,sans-Serif" font-size="14" font-weight="bold" text-anchor="middle">pub key</text></g><g id="edge8" class="edge"><title>invite_manager-&gt;learn_key</title><path fill="none" stroke="#006400" d="M707.8521,-35C757.9748,-35 829.1828,-35 872.2155,-35"/><text x="785.198" y="-37.8" fill="#006400" font-family="Helvetica,sans-Serif" font-size="14" text-anchor="middle">valid token</text></g><g id="edge14" class="edge"><title>invite_manager-&gt;err_and_exit</title><path fill="none" stroke="red" d="M707.8521,-52.7546C759.019,-68.5437 832.1589,-91.1133 874.868,-104.2926"/><text x="785.198" y="-91.8" fill="red" font-family="Helvetica,sans-Serif" font-size="14" text-anchor="middle">invalid token</text></g><g id="node7" class="node"><title>ssh_proxy</title><path fill="none" stroke="#006400" d="M877.0117,-168C877.0117,-168 942.1221,-168 942.1221,-168 948.1221,-168 954.1221,-174 954.1221,-180 954.1221,-180 954.1221,-192 954.1221,-192 954.1221,-198 948.1221,-204 942.1221,-204 942.1221,-204 877.0117,-204 877.0117,-204 871.0117,-204 865.0117,-198 865.0117,-192 865.0117,-192 865.0117,-180 865.0117,-180 865.0117,-174 871.0117,-168 877.0117,-168"/><text x="909.567" y="-188.8" fill="#006400" font-family="Helvetica,sans-Serif" font-size="14" font-weight="bold" text-anchor="middle">SSH proxy</text><text x="909.567" y="-174.8" fill="#006400" font-family="Helvetica,sans-Serif" font-size="14" font-weight="bold" text-anchor="middle">Jump-Host</text></g><g id="edge7" class="edge"><title>acl_manager-&gt;ssh_proxy</title><path fill="none" stroke="#006400" d="M704.0566,-192.4569C738.7694,-193.1138 784.9041,-193.4561 825.6738,-192 838.3694,-191.5466 852.1251,-190.7084 864.7541,-189.7993"/><text x="785.198" y="-195.8" fill="#006400" font-family="Helvetica,sans-Serif" font-size="14" text-anchor="middle">authorized</text></g><g id="edge12" class="edge"><title>acl_manager-&gt;err_and_exit</title><path fill="none" stroke="red" d="M703.7163,-179.7682C743.1076,-170.9461 797.7781,-157.5732 844.6738,-142 854.6331,-138.6927 865.2245,-134.5604 874.8992,-130.5307"/><text x="785.198" y="-172.8" fill="red" font-family="Helvetica,sans-Serif" font-size="14" text-anchor="middle">unauthorized</text></g><g id="node10" class="node"><title>host_1</title><path fill="none" stroke="#00f" d="M1024.5425,-223C1024.5425,-223 1094.7456,-223 1094.7456,-223 1100.7456,-223 1106.7456,-229 1106.7456,-235 1106.7456,-235 1106.7456,-247 1106.7456,-247 1106.7456,-253 1100.7456,-259 1094.7456,-259 1094.7456,-259 1024.5425,-259 1024.5425,-259 1018.5425,-259 1012.5425,-253 1012.5425,-247 1012.5425,-247 1012.5425,-235 1012.5425,-235 1012.5425,-229 1018.5425,-223 1024.5425,-223"/><text x="1059.644" y="-236.8" fill="#00f" font-family="Helvetica,sans-Serif" font-size="14" font-weight="bold" text-anchor="middle">root@host1</text></g><g id="edge3" class="edge"><title>ssh_proxy-&gt;host_1</title><path fill="none" stroke="#00f" d="M954.5012,-202.6151C964.678,-206.3678 975.4382,-210.3275 985.46,-214 994.2108,-217.2067 1003.5469,-220.6149 1012.54,-223.8913"/></g><g id="node11" class="node"><title>host_2</title><path fill="none" stroke="#00f" d="M1005.46,-168C1005.46,-168 1113.8281,-168 1113.8281,-168 1119.8281,-168 1125.8281,-174 1125.8281,-180 1125.8281,-180 1125.8281,-192 1125.8281,-192 1125.8281,-198 1119.8281,-204 1113.8281,-204 1113.8281,-204 1005.46,-204 1005.46,-204 999.46,-204 993.46,-198 993.46,-192 993.46,-192 993.46,-180 993.46,-180 993.46,-174 999.46,-168 1005.46,-168"/><text x="1059.644" y="-181.8" fill="#00f" font-family="Helvetica,sans-Serif" font-size="14" font-weight="bold" text-anchor="middle">user@host2:2222</text></g><g id="edge4" class="edge"><title>ssh_proxy-&gt;host_2</title><path fill="none" stroke="#00f" d="M954.1887,-186C966.458,-186 980.0332,-186 993.2463,-186"/></g><g id="node12" class="node"><title>host_3</title><path fill="none" stroke="#00f" d="M1006.6392,-113C1006.6392,-113 1112.6489,-113 1112.6489,-113 1118.6489,-113 1124.6489,-119 1124.6489,-125 1124.6489,-125 1124.6489,-137 1124.6489,-137 1124.6489,-143 1118.6489,-149 1112.6489,-149 1112.6489,-149 1006.6392,-149 1006.6392,-149 1000.6392,-149 994.6392,-143 994.6392,-137 994.6392,-137 994.6392,-125 994.6392,-125 994.6392,-119 1000.6392,-113 1006.6392,-113"/><text x="1059.644" y="-126.8" fill="#00f" font-family="Helvetica,sans-Serif" font-size="14" font-weight="bold" text-anchor="middle">root@host3:1234</text></g><g id="edge5" class="edge"><title>ssh_proxy-&gt;host_3</title><path fill="none" stroke="#00f" d="M954.1887,-169.6471C971.9014,-163.1558 992.3359,-155.667 1010.4731,-149.0201"/></g></g></svg>